/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("sap.ca.ui.quickoverview.EmployeeLaunch");sap.ca.scfld.md.controller.BaseDetailController.extend("publicservices.her.mycourses.s1.view.S3",{onInit:function(){var v=this.getView();this.bActClick=false;this.sModSetting="";this.oResBundle=this.oApplicationFacade.getResourceBundle();if(!sap.ui.Device.system.phone){this.byId('panEvents').destroyContent();if(sap.ui.getCore().byId('lineItemListCoreq')){sap.ui.getCore().byId('lineItemListCoreq').destroy();}var c=new sap.ui.xmlfragment('publicservices.her.mycourses.s1.template.CoreqEvent',this);this.byId('panEvents').addContent(c);var d=new sap.ui.xmlfragment('publicservices.her.mycourses.s1.template.DetailsPage',this);this.getPage().addContent(d);}else{this.byId('panEvents').destroyContent();if(sap.ui.getCore().byId('lineItemListCoreq')){sap.ui.getCore().byId('lineItemListCoreq').destroy();}var a=new sap.ui.xmlfragment('publicservices.her.mycourses.s1.template.CoreqEventMobile',this);this.byId('panEvents').addContent(a);var b=new sap.ui.xmlfragment('publicservices.her.mycourses.s1.template.DetailsPageMobile',this);this.getPage().addContent(b);}if(sap.ui.getCore().byId('sEligId')){sap.ui.getCore().byId('sEligId').destroy();}this.oRouter.attachRoutePatternMatched(function(e){if(e.getParameter("name")==="detail"){var C=e.getParameter("arguments").contextPath;C=C.substr(C.indexOf('('),C.indexOf(')'));C='/CourseDetailSet'+C;var l=this.oApplicationImplementation.oSplitContainer.getMasterPages()[0].getController().getList().getItems()[1];if(this.oApplicationFacade.oDtlsInitLoad&&l.getSelected()){v.setModel(this.oApplicationFacade.oDtlsJSONModel);this.byId('tabContact').setModel(this.oApplicationFacade.getODataModel());v.bindElement("/result");if(this.oApplicationFacade.oDtlsJSONModel.getData().result){var s=this.oApplicationFacade.oDtlsJSONModel.getProperty("/result/CoReqIndicator");var E=this.oApplicationFacade.oDtlsJSONModel.getProperty("/result/EligibilityIndicator");this.setDetailPageConfig(s,E);this.getActionButton(false);this.oApplicationFacade.oDtlsInitLoad=false;}}else{if(v.getModel()instanceof sap.ui.model.json.JSONModel){v.unbindElement();}v.setModel(this.oApplicationFacade.getODataModel());v.bindElement(C,{expand:"EventDetails,EligibilityDetails,CoRequistesDetails"});this.attachDtlsDataReceived();}var T=this.byId('iconTabBar');var i=T.getItems()[0];var p=jQuery.sap.byId(T.getId()).length>0?true:false;if((!T.getExpanded()&&T.getSelectedKey()===i.getKey()&&p)||(T.getSelectedKey()!=i.getKey()&&p)){T.setSelectedItem(i);}}},this);var t=this;var B=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();this.oHeaderFooterOptions={oEditBtn:{},buttonList:[{}],oAddBookmarkSettings:{title:"Another test",icon:"sap-icon://Fiori2/F0004"}};},attachDtlsDataReceived:function(){var v=this.getView();var b=v.getObjectBinding();b.attachEvent('dataReceived',function(e){this.getActionButton(false);var c=e.getSource().getBoundContext().getObject().CoReqIndicator;var E=e.getSource().getBoundContext().getObject().EligibilityIndicator;this.setDetailPageConfig(c,E);},this);},setDetailPageConfig:function(c,e){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();var v=this;var m=this.getView().getModel();var B=this.getView().getBindingContext();var o=[];var C=m.getContext(B.sPath).getProperty('CoReqIndicator');var E=m.getContext(B.sPath).getProperty('CoRequistesDetails');var a=[];var d=[];var i;if(E.length=='0'&&C=='X'){var l=this.getView().getBindingContext().getProperty("EligibilityDetails").length;if(l>0){for(i=0;i<l;i++){var V=this.getView().getModel().getContext("/"+this.getView().getBindingContext().getProperty("EligibilityDetails")[i]).getObject();var f=this.getView().getModel().getContext("/"+this.getView().getBindingContext().getProperty("EligibilityDetails")[i]).getObject().Sclas;if(f=="CR"){if(jQuery.inArray(V.Sobid,d)===-1){var O={"CourseId":V.Sobid,"CourseName":V.RelObjStext};o.push(O);d.push(V.Sobid);}a.push(V);}}}}else{for(i=0;i<E.length;i++){var g;if(m instanceof sap.ui.model.json.JSONModel)g=E[i];else g=m.getData('/'+E[i]);if(jQuery.inArray(g.CourseId,d)===-1){var O={"CourseId":g.CourseId,"CourseName":g.CourseName};o.push(O);d.push(g.CourseId);}a.push(g);}}var M=new sap.ui.model.json.JSONModel();var t=jQuery.extend(true,{},{"CoRequistesDetails":a});M.setData(t);var h=new sap.ui.model.json.JSONModel();h.setData({"Events":o});var L=v.byId('vLayoutCoreq');L.setModel(h,'CourseNos');L.setModel(M,'CoreqEvents');var p=m.getContext(B.sPath).getProperty('EventDetails');var P=[];var j;for(j=0;j<p.length;j++){var k;if(m instanceof sap.ui.model.json.JSONModel){k=p[j];}else{k=m.getData('/'+p[j]);}P.push(k);}var n=new sap.ui.model.json.JSONModel();n.setData({"EventDetails":P});var q=sap.ui.getCore().byId('lineItemList');q.setModel(n,'PrimEvents');},setEligText:function(s,c,e){var b=this.getView().getBindingContext();if(c==null||e==null){if(b){c=this.getView().getBindingContext().getObject().CoReqIndicator;e=this.getView().getBindingContext().getObject().EligibilityIndicator;}}var B=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();var C='';if(b){C=b.getObject().ConditionalBookingIndicator;}if(C=="X"){this.byId('txtElig').setText(B.getText('CONDN_BOOKING_TXT'));if(c=='X'){this.byId('coreqId').setVisible(true);this.byId('CoreqLink').setVisible(true);}else{this.byId('coreqId').setVisible(false);this.byId('CoreqLink').setVisible(false);}}else if(s=='Booked'){this.byId('txtElig').setText(B.getText('BOOKED_TXT'));if(c=='X'){this.byId('coreqId').setVisible(true);this.byId('CoreqLink').setVisible(true);}else{this.byId('coreqId').setVisible(false);this.byId('CoreqLink').setVisible(false);}}else if(c=='X'){this.byId('coreqId').setVisible(true);if(e=='X'){this.byId('txtElig').setText(B.getText('YOU_ARE_NOT_ELIG'));}else{this.byId('txtElig').setText(B.getText('COREQ_TXT'));}this.byId('CoreqLink').setVisible(true);}else{if(e=='X'){this.byId('txtElig').setText(B.getText('YOU_ARE_NOT_ELIG'));}else{this.byId('txtElig').setText(B.getText('YOU_CAN_BOOK'));}this.byId('coreqId').setVisible(false);this.byId('CoreqLink').setVisible(false);}},onTabSelect:function(e){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();this.byId('contactLbl').setVisible(false);var t=this.byId('iconTabBar');if(e.getParameters().selectedKey=='Contacts'){var i=t.getItems()[3];var c=this.getView().getBindingContext().getObject().CourseId;i.bindElement("/ModuleContactDataSet('"+c+"')");if(i.getBindingContext()){if(i.getBindingContext().getObject().Name==""){this.byId('contactLbl').setText(b.getText('NO_DATA'));this.byId('contactLbl').setVisible(true);}else{this.byId('contactLbl').setVisible(false);this.byId('contactLbl').setText(null);}}var B=i.getObjectBinding();B.attachEvent('dataReceived',function(E,d){if(E.getSource().getBoundContext().getObject().Name==""){this.byId('contactLbl').setText(b.getText('NO_DATA'));this.byId('contactLbl').setVisible(true);}else{this.byId('contactLbl').setVisible(false);this.byId('contactLbl').setText(null);}},this);}else if(e.getParameters().selectedKey=='detailsTab'){var i=t.getItems()[2];i.setBindingContext(this.getView().getBindingContext());}else if(e.getParameters().selectedKey=='info'){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();if(this.byId('txtElig').getText()==b.getText('YOU_ARE_NOT_ELIG')){this.byId('txtElig').getDomRef().style.color='rgb(204,25,25)';}}var o=sap.ui.getCore().byId('lineItemList');if(e.getParameters().selectedKey=='Coreq'){if(o){o.setVisible(false);}}else{if(o){o.setVisible(true);}}},pressChkElig:function(e){var c=e.getSource();if(!this.oPopover){this.oPopover=sap.ui.xmlfragment("publicservices.her.mycourses.s1.template.Eligibility",this);this.oPopover.setModel(this.oApplicationImplementation.AppI18nModel,'i18n');this.oPopover.setModel(this.getView().getModel());}this.oPopover.setBindingContext(this.getView().getBindingContext());this.oPopover.openBy(c);},fnOpenPopup:function(e){var b=e.getSource().getBindingContext();var i=b.getObject().InstrObjId;var c=e.getSource();this.InstructorPopup(c,i);},fnOpenPopupCoreq:function(e){var i='';if(e.getSource().getBindingContext('CoreqEvents')){i=e.getSource().getBindingContext('CoreqEvents').getObject().InstrObjId;}var c=e.getSource();this.InstructorPopup(c,i);},fnOpenPopupEventContact:function(e){var i='';if(e.getSource().getBindingContext('PrimEvents')){i=e.getSource().getBindingContext('PrimEvents').getObject().InstrObjId;}var c=e.getSource();this.InstructorPopup(c,i);},InstructorPopup:function(c,i){jQuery.sap.require("sap.ca.ui.quickoverview.Quickoverview");var s="publicservices.her.mycourses.s1.template.Employee";if(i!=undefined){var b=jQuery.proxy(function(o,S){o.bindElement("/ContactDetailSet('"+i+"')");},this);var q={title:this.oResBundle.getText("PROFESSOR"),headerTitle:"{Name}",headerSubTitle:"{Position}\n{Department}",subViewName:s,headerImgURL:"{PhotoURI}",oModel:this.oApplicationFacade.getODataModel(),afterQvConfigured:b,popoverHeight:'32em',};var Q=new sap.ca.ui.quickoverview.Quickoverview(q);Q.openBy(c);}},getHeaderFooterOptions:function(){return this.oHeaderFooterOptions;},getActionButton:function(d,a){var l=this.oApplicationImplementation.oSplitContainer.getMasterPages()[0].getController().getList().getSelectedItem();var t=this;if(l==null&&(d||sap.ui.Device.system.phone)){if(a||this.bActClick||sap.ui.Device.system.phone){this.bActClick=false;sap.ca.ui.utils.busydialog.requireBusyDialog();var c='';var A='';var s='';var p='';var P='';if(this.getView().getBindingContext()){c=this.getView().getBindingContext().getObject().CourseId;A=this.getView().getBindingContext().getObject().AcademicYear;s=this.getView().getBindingContext().getObject().AcademicSession;p=this.getView().getBindingContext().getObject().ProgType;P=this.getView().getBindingContext().getObject().ProgramStudyId;}var f="CourseId eq '"+c+"'and ProgramStudyId eq '"+P+"'and ProgType eq '"+p+"' and AcademicSession eq '"+s+"' and AcademicYear eq '"+A+"' and ListInd eq 'NAV'";this.getView().getModel().read('/CourseListSet',null,{"$filter":f},true,function(D,R){sap.ca.ui.utils.busydialog.releaseBusyDialog();var R=D.results[0];if(R!=undefined){t.setActionButton(R.ListInd,R.Seats,R.StatusCode,R.RegWindInd);t.byId('ATTR1').setText(R.Status);t.setEligText(R.Status,null,null);t.setChkEligText(R.ListInd);t.sModSetting=R.ModuleSetting;}},function(E){jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.log.error("Internal Error","Failed to load data item");sap.ca.ui.utils.busydialog.releaseBusyDialog();});}}else{if(l&&l.getBindingContext()){var v='';var S='';var b='';var r='';var e='';v=l.getBindingContext().getProperty('ListInd');S=l.getBindingContext().getProperty('Seats');r=l.getBindingContext().getProperty('RegWindInd');e=l.getBindingContext().getProperty('Status');b=l.getBindingContext().getProperty('StatusCode');this.byId('ATTR1').setText(e);t.setEligText(e,null,null);this.setChkEligText(v);this.setActionButton(v,S,b,r);this.sModSetting=l.getBindingContext().getProperty('ModuleSetting');}}},setChkEligText:function(s){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();if(s=="REG"){this.byId('eligibilityLinkId').setText(b.getText('CHK_FULL_REQ'));}else{this.byId('eligibilityLinkId').setText(b.getText('CHK_ELIG'));}if(this.getView().getBindingContext()){var l="";var f=null;var i=null;if(this.getView().getBindingContext().getObject().EligibilityDetails.length>=0){l=this.getView().getBindingContext().getObject().EligibilityDetails.length;if(l>0){var v=this.getView().getBindingContext().getObject().EligibilityDetails[0].CourseObjId;for(i=0;i<l;i++){var c=this.getView().getBindingContext().getObject().EligibilityDetails[0].CourseObjId.Sclas;if(c=="PR"){f="PR";}}if(v!=null&&f=="PR"){this.byId('eligibilityHboxId').setVisible(true);this.byId('eligibilityLinkLblId').setVisible(true);this.byId('eligibilityLinkLblId2').setVisible(true);}else{this.byId('eligibilityHboxId').setVisible(false);this.byId('eligibilityLinkLblId').setVisible(false);this.byId('eligibilityLinkLblId2').setVisible(false);}}else{this.byId('eligibilityHboxId').setVisible(false);this.byId('eligibilityLinkLblId').setVisible(false);this.byId('eligibilityLinkLblId2').setVisible(false);}}else{l=this.getView().getBindingContext().getObject().EligibilityDetails.__list.length;if(l>0){var v=this.getView().getModel().getContext("/"+this.getView().getBindingContext().getObject().EligibilityDetails.__list[0]).getObject().CourseObjId;for(i=0;i<l;i++){var c=this.getView().getModel().getContext("/"+this.getView().getBindingContext().getObject().EligibilityDetails.__list[i]).getObject().Sclas;if(c=="PR"){f="PR";}}if(v!=null&&f=="PR"){this.byId('eligibilityHboxId').setVisible(true);this.byId('eligibilityLinkLblId').setVisible(true);this.byId('eligibilityLinkLblId2').setVisible(true);}else{this.byId('eligibilityHboxId').setVisible(false);this.byId('eligibilityLinkLblId').setVisible(false);this.byId('eligibilityLinkLblId2').setVisible(false);}}else{this.byId('eligibilityHboxId').setVisible(false);this.byId('eligibilityLinkLblId').setVisible(false);this.byId('eligibilityLinkLblId2').setVisible(false);}}}},openDialog:function(e){var t='Withdraw';if(!this[t]){this[t]=sap.ui.xmlfragment("publicservices.her.mycourses.s1.template."+t+"Dialog",this);this.getView().addDependent(this[t]);}jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this[t]);this[t].open();},onDialogCloseButton:function(e){var t=e.getSource().data("dialogType");if(e.getSource().data("Key")=="btn_ok"){var r=sap.ui.getCore().byId('select').getSelectedItem().getBindingContext().getObject().CancelReasonCode;this.triggerAction('CancelBooking',r);}this[t].close();},getDetailSeats:function(v,s,r){if((v!=null&&v)){var o=this.byId('objstat');var S=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('SEATS');if(s=='REG'||r){o.setText('');return;}if(s=="WAIT"){var w=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('WAIT_LIST_SEATS');if(this.getView().getBindingContext()){var V=this.getView().getBindingContext().getObject().WaitlistNumber;if((V!=null&&V)){if(V=='0'){o.setState('Error');o.setText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NO_PLACES'));}else{o.setState('Error');o.setText(w+V);}}}}else{if(v=='0'){o.setState('Error');o.setText(sap.ca.scfld.md.app.Application.getImpl().getResourceBundle().getText('NO_PLACES'));}else{o.setState('Success');o.setText(v+" "+S);}}}},setActionButton:function(v,s,S,r){var t=this;var B=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();var C='';if(this.getView().getBindingContext()){C=this.getView().getBindingContext().getObject().CoReqIndicator;}if(r){if(v=='ALL'){this.oHeaderFooterOptions.buttonList=[{sId:"btnwishlist",bDisabled:false,sI18nBtnTxt:B.getText('ADD_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('AddToWishList');}}];this.oHeaderFooterOptions.oEditBtn=undefined;}else if(v=='WISH'){this.oHeaderFooterOptions.buttonList=[{sId:"btnRemoveWishList",bDisabled:false,sI18nBtnTxt:B.getText('REMOVE_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('RemoveFromWishList');}}];this.oHeaderFooterOptions.oEditBtn=undefined;}else{this.oHeaderFooterOptions.buttonList=[];this.oHeaderFooterOptions.oEditBtn=undefined;}}else{if(v=='REG'&&(S==='01')){this.oHeaderFooterOptions.buttonList=[{sId:"btnWithDraw",bDisabled:false,sI18nBtnTxt:B.getText('WITHDRAW'),onBtnPressed:function(e){t.openDialog(e);}}];this.oHeaderFooterOptions.oEditBtn={bDisabled:true,sI18nBtnTxt:B.getText('SAVE_CHANGES'),onBtnPressed:function(e){t.triggerAction('SaveChanges');}};}else if(v=='REG'&&(S==='03'||S==='02')){this.oHeaderFooterOptions.buttonList=[];this.oHeaderFooterOptions.oEditBtn=undefined;}else if(v=='ALL'&&s>0){var d='';if(C=='X'){d=B.getText('REG_COREQ');}else{d=B.getText('REGISTER');}this.oHeaderFooterOptions.buttonList=[{sId:"btnAddWishList",bDisabled:false,sI18nBtnTxt:B.getText('ADD_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('AddToWishList');}}];this.oHeaderFooterOptions.oEditBtn={sI18nBtnTxt:d,bDisabled:true,onBtnPressed:function(){t.triggerAction('BookCourse');}};}else if(v=='ALL'&&s==0){this.oHeaderFooterOptions.buttonList=[{sId:"btnwishlist",bDisabled:false,sI18nBtnTxt:B.getText('ADD_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('AddToWishList');}}];this.oHeaderFooterOptions.oEditBtn={sI18nBtnTxt:B.getText('ADD_WAITING_LIST'),bDisabled:true,onBtnPressed:function(e){t.triggerAction('AddToWaitList');}};}else if(v==='WISH'&&s>0){var d='';if(C==='X'){d=B.getText('REG_COREQ');}else{d=B.getText('REGISTER');}this.oHeaderFooterOptions.buttonList=[{sId:"btnRemoveWishList",bDisabled:false,sI18nBtnTxt:B.getText('REMOVE_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('RemoveFromWishList');}}];this.oHeaderFooterOptions.oEditBtn={sI18nBtnTxt:d,bDisabled:true,onBtnPressed:function(e){t.triggerAction('BookCourse');}};}else if(v=='WISH'&&s==0){this.oHeaderFooterOptions.buttonList=[{sId:"btnRemoveWishList",bDisabled:false,sI18nBtnTxt:B.getText('REMOVE_WISH_LIST'),onBtnPressed:function(e){t.triggerAction('RemoveFromWishList');}}];this.oHeaderFooterOptions.oEditBtn={sI18nBtnTxt:B.getText('ADD_WAITING_LIST'),bDisabled:true,onBtnPressed:function(e){t.triggerAction('AddToWaitList');}};}else if(v=='WAIT'){this.oHeaderFooterOptions.buttonList=[{sI18nBtnTxt:B.getText('WITHDRAW'),bDisabled:false,onBtnPressed:function(e){t.openDialog(e);}}];this.oHeaderFooterOptions.oEditBtn={sId:"btnSaveChanges",bDisabled:true,sI18nBtnTxt:B.getText('SAVE_CHANGES'),onBtnPressed:function(e){t.triggerAction('SaveChanges');}};}else{this.oHeaderFooterOptions.buttonList=[];this.oHeaderFooterOptions.oEditBtn=undefined;}}this.setHeaderFooterOptions(this.oHeaderFooterOptions);var T=sap.ui.getCore().byId('lineItemList');T.attachUpdateFinished(function(a,b,c){this.setEnableFooterButton(v);},this);this.setEnableFooterButton(v);},setEnableFooterButton:function(v){var t=sap.ui.getCore().byId('lineItemList');if(this.oHeaderFooterOptions.oEditBtn){if(this.getView().getBindingContext()){if(this.getView().getBindingContext().getObject().EligibilityIndicator==='X'){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;}}else if(v=='REG'||v=='WAIT'){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;}else if(t.getItems()&&t.getItems().length<1){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;}else{this.oHeaderFooterOptions.oEditBtn.bDisabled=true;}}this.setHeaderFooterOptions(this.oHeaderFooterOptions);var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();if(this.byId('txtElig').getText()==b.getText('YOU_ARE_NOT_ELIG')){this.byId('txtElig').getDomRef().style.color='rgb(204,25,25)';}},getEventTables:function(a,r){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();var t=[];var T=[];var p=[];var c=[];var o=sap.ui.getCore().byId('lineItemList');T.push(o);if(o.getItems().length>0){t.push(o);p.push(o);}var C='';if(this.getView().getBindingContext()){C=this.getView().getBindingContext().getObject().CoReqIndicator;}var d=this.byId('vLayoutCoreq').getContent();for(var i=0;i<d.length;i++){var e=d[i].getContent()[0];T.push(e);if(e.getItems().length>0){t.push(e);c.push(e);}}if(t.length>0){if(c.length>0){var s=0;for(var i=0;i<c.length;i++){for(var j=1;j<c[i].getItems().length;j++){var f=c[i].getItems()[j];if(f.getTitle==undefined){var R=f.getCells()[0];if(R.getSelected()){s++;break;}}}}if(c.length!==s&&c.length>0){this.getMsgToast(b.getText('COREQ_EVENT_VALIDATE'));var g=this.byId('iconTabBar');g.setSelectedKey("Coreq");g.fireSelect({"selectedKey":"Coreq"});return;}}else if(C=='X'&&c.length>0){this.getMsgToast(b.getText('COREQ_EVENT_VALIDATE'));var h=this.byId('iconTabBar');h.setSelectedKey("Coreq");h.fireSelect({"selectedKey":"Coreq"});return;}if(p.length>0){var k=false;for(var i=1;i<p[0].getItems().length;i++){var f=p[0].getItems()[i];if(f.getTitle==undefined){var R=f.getCells()[0];if(R.getSelected()){k=true;break;}}}if(k==false&&p[0].getItems().length>0){this.getMsgToast(b.getText('EVENT_VALIDATE'));var l=this.byId('iconTabBar');l.setSelectedKey("info");l.fireSelect({"selectedKey":"info"});return;}}}var D=this.getActionEvents(T,a,r);return D;},getMsgToast:function(m){sap.m.MessageToast.show(m,{duration:5000,width:"30em",my:"center center",at:"center center",of:window,offset:"0 0",collision:"fit fit",onClose:null,autoClose:true,animationTimingFunction:"ease",animationDuration:1000,closeOnBrowserNavigation:true});},getActionEvents:function(t,a,r){var p='';var P='';var b='';var c='';var m='';var e='';var E='';var s='';var C=false;var B=this.getView().getBindingContext();if(B){p=B.getProperty('AcademicSession');P=B.getProperty('AcademicYear');b=B.getProperty('ProgramStudyId');c=B.getProperty('ProgType');m=B.getProperty('CourseId');if(this.sModSetting==="SC"){c="";}else if(this.sModSetting==="PT"){b="";}}var d=null;if(t.length>0){for(var j=0;j<t.length;j++){var T=t[j];if(T.getItems().length===0){if(T.getBindingContext('CourseNos')){m=T.getBindingContext('CourseNos').getObject().CourseId;}if(d==null){d={ModuleObjId:m,EventObjId:'',ActionName:a,Periodid:p,Periodyear:P,ProgramId:b,ProgramType:c,ModuleCoreqItems:[],EventPckId:'',CancelReasonCode:r,CancelEvent:C};}else{d.ModuleCoreqItems.push({EventObjId:'',ModuleObjId:m,EventPckId:'',CancelEvent:C});}}else{for(var i=1;i<T.getItems().length;i++){C=false;var o=T.getItems()[i];if(o.getTitle===undefined){var R=o.getCells()[0];if(R.getSelected()||a==='CancelBooking'||a==='SaveChanges'){if(R.getBindingContext('CoreqEvents')==undefined){e=R.getBindingContext('PrimEvents').getObject().EventObjectId;m=R.getBindingContext('PrimEvents').getObject().CourseId;E=R.getBindingContext('PrimEvents').getObject().EventsPackageId;s=R.getBindingContext('PrimEvents').getObject().RegisterIndicator;}else{e=R.getBindingContext('CoreqEvents').getObject().EventObjectId;m=R.getBindingContext('CoreqEvents').getObject().CourseId;E=R.getBindingContext('CoreqEvents').getObject().EventsPackageId;s=R.getBindingContext('CoreqEvents').getObject().RegisterIndicator;}var A=true;if(a==='CancelBooking'&&s===true){C=true;}else if(a==='CancelBooking'&&s===false){A=false;}if(a==='SaveChanges'){if(s===true&&R.getSelected()){C=false;if(d===null){d={ModuleObjId:m,EventObjId:e,ActionName:a,Periodid:p,Periodyear:P,ProgramId:b,ProgramType:c,ModuleCoreqItems:[],EventPckId:E,CancelReasonCode:r,CancelEvent:C};}else{d.ModuleCoreqItems.push({EventObjId:e,ModuleObjId:m,EventPckId:E,CancelEvent:C});}}if(s===true){C=true;}else if(s===false&&!(R.getSelected())){A=false;}}if(A){if(d===null){d={ModuleObjId:m,EventObjId:e,ActionName:a,Periodid:p,Periodyear:P,ProgramId:b,ProgramType:c,ModuleCoreqItems:[],EventPckId:E,CancelReasonCode:r,CancelEvent:C};}else{d.ModuleCoreqItems.push({EventObjId:e,ModuleObjId:m,EventPckId:E,CancelEvent:C});}}}}}}}}return d;},triggerAction:function(a,r){var b=sap.ca.scfld.md.app.Application.getImpl().getResourceBundle();if((a==="BookCourse"||a==="SaveChanges"||a==="AddToWaitList")&&this.getView().getBindingContext().getObject().EligibilityIndicator==="X"){this.getMsgToast(b.getText("YOU_ARE_NOT_ELIG"));return;}sap.ca.ui.utils.busydialog.requireBusyDialog();var d='';if(a=="AddToWishList"||a=="RemoveFromWishList"){var p='';var P='';var c='';var e='';var m='';var B=this.getView().getBindingContext();if(B){p=B.getProperty('AcademicSession');P=B.getProperty('AcademicYear');c=B.getProperty('ProgramStudyId');e=B.getProperty('ProgType');m=B.getProperty('CourseId');if(this.sModSetting==="SC"){e="";}else if(this.sModSetting==="PT"){c="";}}d={ModuleObjId:m,ActionName:a,Periodid:p,Periodyear:P,ProgramId:c,ProgramType:e,CancelReasonCode:r};}else{d=this.getEventTables(a,r);}var f=this.oApplicationFacade.getODataModel();if(d){if(d.ModuleCoreqItems){if(d.ModuleCoreqItems.length==0&&(a!="SaveChanges"&&a!="CancelBooking")){delete d.ModuleCoreqItems;}}var s=jQuery.proxy(function(g){var A=this.getView().getBindingContext().getProperty('Acad_Sess');var h=this.getView().getBindingContext().getProperty('Acad_Year');var j=h+" "+A;var C=this.getView().getBindingContext().getProperty('CourseName');var M='';if(g.ErrorMessage!==""){M=g.ErrorMessage;sap.ca.ui.utils.busydialog.releaseBusyDialog();this.getMsgToast(M);return;}else if(g.ActionName=='BookCourse'){M=b.getText('REG_SUCCESS',[j]);}else if(g.ActionName=='CancelBooking'){M=b.getText('CANCEL_SUCCESS',[j]);}else if(g.ActionName=='AddToWishList'){M=b.getText('WISH_SUCCESS',[C]);}else if(g.ActionName=='RemoveFromWishList'){M=b.getText('REMOVE_WISH_SUCCESS',[C]);}else if(g.ActionName=='AddToWaitList'){M=b.getText('WAIT_SUCCESS',[C]);}else if(g.ActionName=='SaveChanges'){M=b.getText('SAVE_SUCCESS');};var o=this.oApplicationImplementation.oSplitContainer.getMasterPages()[0].getController().getList();if(g.ActionName!=='BookCourse'){this.oApplicationImplementation.oSplitContainer.getMasterPages()[0].getController().onListerFiltering();}else{var S='';if(o.getSelectedItem()){S=o.getSelectedItem().getBindingContext().getPath().substr(1);}else{var U=sap.ushell.Container.getService("URLParsing");var k=U.getHash(location.href);var D=k.substr(k.indexOf('('),k.indexOf(')'));S='CourseListSet'+D;}f.oData[S].ListInd=g.ListInd;f.oData[S].Seats=" ";f.oData[S].RegWindInd=g.RegWindStatus;f.oData[S].StatusCode=g.Status;f.oData[S].Status=g.Smstatust;var l=g.ModuleCoreqItems.results;if(l!=undefined){for(var i=0;l&&i<l.length;i++){S="CourseListSet(CourseId='"+l[i].ModuleObjId+"',ProgramStudyId='"+g.ProgramId+"',ProgType='"+g.ProgramType+"',AcademicYear='"+g.Periodyear+"',AcademicSession='"+g.Periodid+"')";if(f.oData[S]==undefined){S="CourseListSet(CourseId='"+l[i].ModuleObjId+"',ProgramStudyId='"+g.ProgramId+"',ProgType='"+g.ProgramType+"',AcademicSession='"+g.Periodid+"',AcademicYear='"+g.Periodyear+"')";}if(f.oData[S]){f.oData[S].ListInd=l[i].ListInd;f.oData[S].Seats=" ";f.oData[S].RegWindInd=l[i].RegWindStatus;f.oData[S].StatusCode=l[i].Status;f.oData[S].Status=l[i].Smstatust;}}}this.setActionButton(g.ListInd,'',g.Status,g.RegWindStatus);this.byId('ATTR1').setText(g.Smstatust);var n=null;o.removeItem(o.getSelectedItem());o.getItems().forEach(function(i){if(n===null){n=i;}if(i.getId()!==n.getId()&&i instanceof sap.m.GroupHeaderListItem&&n instanceof sap.m.GroupHeaderListItem){n.destroy();}n=i;});}if(this.getView().getModel()instanceof sap.ui.model.json.JSONModel){var v=this.getView();var D=k.substr(k.indexOf('('),k.indexOf(')'));D='/CourseDetailSet'+D;v.unbindElement();v.setModel(this.oApplicationFacade.getODataModel());v.bindElement(D,{expand:"EventDetails,EligibilityDetails,CoRequistesDetails"});this.attachDtlsDataReceived();}sap.ca.ui.utils.busydialog.releaseBusyDialog();this.getMsgToast(M);},this);var E=jQuery.proxy(function(g){sap.ca.ui.utils.busydialog.releaseBusyDialog();this.getMsgToast(b.getText('ERROR_MSG'));},this);this.bActClick=true;f.create("/ActionHdrSet",d,{success:s,error:E,async:true});}else{sap.ca.ui.utils.busydialog.releaseBusyDialog();}},onRadioBtnClick:function(e){if(this.oHeaderFooterOptions.oEditBtn){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;if(this.oHeaderFooterOptions.buttonList.length>0){this.oHeaderFooterOptions.buttonList[0].bDisabled=false;}this.setHeaderFooterOptions(this.oHeaderFooterOptions);}if(e.getParameters().selected){var n="";if(this.getView().getBindingContext()){n=this.getView().getBindingContext().getObject().EligibilityIndicator;}var E=e.getSource().getBindingContext('PrimEvents').getObject().EventsPackageId;if(E=="00000000"||E==""||(E||null)==null){}else{var t=sap.ui.getCore().byId('lineItemList');var s=e.getSource().getGroupName();for(var i=1;i<t.getItems().length;i++){var T=t.getItems()[i];if(T.getTitle==undefined){var r=T.getCells()[0];if((r.getBindingContext('PrimEvents').getObject().EventsPackageId==E)&&(s!=r.getGroupName())){r.setSelected(true);}else if((r.getBindingContext('PrimEvents').getObject().EventsPackageId!=E)&&(s!=r.getGroupName())){r.setSelected(false);}}}}if(n==="X"){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}else if(e.getSource().getBindingContext('PrimEvents').getObject().RegisterIndicator===false){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}else{var t=sap.ui.getCore().byId('lineItemList');for(var i=1;i<t.getItems().length;i++){var T=t.getItems()[i];if(T.getTitle==undefined){var r=T.getCells()[0];if((r.getBindingContext('PrimEvents').getObject().CategoryText!==e.getSource().getBindingContext('PrimEvents').getObject().CategoryText)){if((r.getBindingContext('PrimEvents').getObject().RegisterIndicator==false)&&r.getSelected()){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions);break;}}else if(r.getBindingContext('PrimEvents').getObject().RegisterIndicator==true){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}}}}}},onRadioBtnClickCoreq:function(e){if(this.oHeaderFooterOptions.oEditBtn){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;if(this.oHeaderFooterOptions.buttonList.length>0){this.oHeaderFooterOptions.buttonList[0].bDisabled=false;}this.setHeaderFooterOptions(this.oHeaderFooterOptions);}if(e.getParameters().selected){var n="";if(this.getView().getBindingContext()){n=this.getView().getBindingContext().getObject().EligibilityIndicator;}var r=e.getSource().getCustomData()[0].getValue();var l=this.byId('vLayoutCoreq').getContent();var t='';for(var i=0;i<l.length;i++){if(l[i].getCustomData()[0].getValue()==r){t=l[i].getContent()[0];break;}}var E=e.getSource().getBindingContext('CoreqEvents').getObject().EventsPackageId;if(E=="00000000"||E==""||(E||null)==null){return;}var s=e.getSource().getGroupName();for(var i=1;i<t.getItems().length;i++){var T=t.getItems()[i];if(T.getTitle==undefined){var R=T.getCells()[0];if((R.getBindingContext('CoreqEvents').getObject().EventsPackageId==E)&&(s!=R.getGroupName())){R.setSelected(true);}else if((R.getBindingContext('CoreqEvents').getObject().EventsPackageId!=E)&&(s!=R.getGroupName())){R.setSelected(false);}}}if(n==="X"){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}else if(e.getSource().getBindingContext('CoreqEvents').getObject().RegisterIndicator===false&&n!=="X"){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}else{for(var i=1;i<t.getItems().length;i++){var T=t.getItems()[i];if(T.getTitle==undefined){var R=T.getCells()[0];if((R.getBindingContext('CoreqEvents').getObject().CategoryText!==e.getSource().getBindingContext('CoreqEvents').getObject().CategoryText)){if((R.getBindingContext('CoreqEvents').getObject().RegisterIndicator==false)&&R.getSelected()){this.oHeaderFooterOptions.oEditBtn.bDisabled=false;this.setHeaderFooterOptions(this.oHeaderFooterOptions);break;}}else if(R.getBindingContext('CoreqEvents').getObject().RegisterIndicator==true){this.oHeaderFooterOptions.oEditBtn.bDisabled=true;this.setHeaderFooterOptions(this.oHeaderFooterOptions);}}}}}},pressCOREQ:function(e){var a=this.byId('iconTabBar');a.setSelectedKey("Coreq");a.fireSelect({"selectedKey":"Coreq"});},seeAllPress:function(e){var m;if(this.getView().getModel().getData()){m=this.getView().getModel().getData().result.ModuleOffered;}else if(this.getView().getBindingContext()){m=this.getView().getBindingContext().getObject().ModuleOffered;}m=m.split(";");var r=[];var i;for(i=0;i<m.length-1;i++){var t={"modOffrd":m[i]};r.push(t);}var M=new sap.ui.model.json.JSONModel();M.setData({"ModuleOffr":r});var c=e.getSource();if(!this.oPopup){this.oPopup=new sap.ui.xmlfragment('publicservices.her.mycourses.s1.template.ModulesOffered',this);this.oPopup.setModel(this.oApplicationImplementation.AppI18nModel,'i18n');}this.oPopup.setModel(M,"mod");this.oPopup.setBindingContext(this.getView().getBindingContext());this.oPopup.openBy(c);},handleCloseButton:function(e){this.oPopup.close();},onExit:function(){if(this.oPopup){this.oPopup.destroy();}},});
